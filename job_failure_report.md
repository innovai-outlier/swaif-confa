# Job Failure Report: https://github.com/innovai-outlier/swaif-confa/actions/runs/16972467976/job/48112773170?pr=2

## Summary
This CI job failed due to multiple `KeyError: 'valor'` exceptions, primarily in integration and unit tests. The failures indicate that the code is attempting to access a column named `valor` in a pandas DataFrame, but this column is missing from the loaded data. Other errors include missing column `'data_venda'` and various assertion errors.

## Errors Observed
```
FAILED tests/integration/test_integration.py::TestIntegracaoCompleta::test_fluxo_completo_conciliacao - KeyError: 'valor'
FAILED tests/integration/test_integration.py::TestIntegracaoCompleta::test_integracao_data_loader_analisador - KeyError: 'valor'
FAILED tests/integration/test_integration.py::TestIntegracaoCompleta::test_performance_sistema_completo - KeyError: 'valor'
FAILED tests/unit/test_controller.py::TestConciliacaoController::test_executar_conciliacao_com_dados - KeyError: 'valor'
FAILED tests/unit/test_data_loader.py::TestDataLoader::test_mapear_colunas_c6_faturamento - AssertionError: 'data_venda' not found in Index(['Data da Venda', 'Valor da Venda', 'Cliente'], dtype='object')
```

## Root Cause
The main cause is a mismatch between expected column names by the code (`valor`, `data_venda`) and the actual columns provided by the data source (`Valor da Venda`, `Data da Venda`).

## Solution
1. **Fix column mapping after loading data:**
   ```python
   expected_columns = {
       'Valor da Venda': 'valor',
       'Data da Venda': 'data_venda'
       # map other columns as needed
   }
   df.rename(columns=expected_columns, inplace=True)
   ```
   Add this to your data loader or preprocessing step.

2. **Update test fixtures:**
   Test data should use the expected internal column names.

3. **Add defensive checks:**
   ```python
   if 'valor' not in df.columns:
       raise ValueError(f"Expected 'valor' column in input data. Found columns: {df.columns}")
   ```

4. **Review and fix assertion errors and calculations**
   Ensure test expectations and calculation logic match actual data and requirements.

## References
- [Job logs @ d2e0a2f167764f09292408f9bbf335b7dfa20866](https://github.com/innovai-outlier/swaif-confa/actions/runs/16972467976/job/48112773170?pr=2)
- Data loader and tests likely affected: `data_loader.py`, `test_data_loader.py`, `test_integration.py`, `test_controller.py`

---
*Generated by GitHub Copilot Chat Assistant on 2025-08-14 17:50:05 UTC*